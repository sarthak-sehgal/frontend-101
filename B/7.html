<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>B7</title>
	<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
	<style type="text/css">
		html, body {
			margin: 0;
			padding: 0;
			overflow: hidden;
		}
		#map {
			position: absolute;
			left: 0;
			top: 0;
			transform-origin: 0 0;
		}
	</style>
</head>
<body>
	<img  id="map" src="map.jpg" />
	<script type="text/javascript">
		var map = document.getElementById('map');
		var down=false;
		var elOffset=[0,0];
		var cursorPos=[0,0];
		var dist;
		// pan events
		map.addEventListener("mousedown", mousedownFunc);
		map.addEventListener("touchstart", touchstartFunc);
		map.addEventListener("mouseup", mouseupFunc);
		map.addEventListener("touchend", touchendFunc);
		map.addEventListener("mousemove", mousemoveFunc);
		map.addEventListener("touchmove", touchmoveFunc);

		// zoom events
		var mousewheelevt=(/Firefox/i.test(navigator.userAgent))? "DOMMouseScroll" : "mousewheel"; //FF doesn't recognize mousewheel as of FF3.x
		map.addEventListener(mousewheelevt, mousewheelFunc);

		function mousedownFunc(e) {
			down=true;
			elOffset=[
				map.offsetLeft - e.clientX,
				map.offsetTop - e.clientY
			];
		}
		var zoom=false;
		function touchstartFunc(e) {
			if(e.touches.length==2)
			{
				zoom=true;
				dist =(e.touches[0].x-e.touches[1].x) * (e.touches[0].x-e.touches[1].x) + (e.touches[0].y-e.touches[1].y) * (e.touches[0].y-e.touches[1].y);
				alert(dist);
			}
			down=true;
			elOffset=[
				map.offsetLeft - e.changedTouches[0].clientX,
				map.offsetTop - e.changedTouches[0].clientY
			];
			e.preventDefault();
		}
		function mouseupFunc() {
			down=false;
			map.style.cursor='default';
		}
		function touchendFunc(e) {
			e.preventDefault();
			down=false;
		}
		function mousemoveFunc(e) {
			e.preventDefault();
			map.ondragstart = function() { return false; };
			if(down)
			{
				cursorPos=[
					e.clientX,
					e.clientY
				];
				map.style.cursor='pointer';
				styleLeft=elOffset[0] + cursorPos[0];
				styleTop=elOffset[1] + cursorPos[1];
				if(styleTop>0)
					styleTop=0;
				if(styleTop<-(map.clientHeight-document.documentElement.clientHeight))
					styleTop=-(map.clientHeight-document.documentElement.clientHeight);
				if(styleLeft>0)
					styleLeft=0;
				if(styleLeft<-(map.clientWidth-document.documentElement.clientWidth))
					styleLeft=-(map.clientWidth-document.documentElement.clientWidth);
				map.style.left =  styleLeft+ 'px';
				map.style.top = styleTop + 'px';
			}
		}
		var tchscale=1.0;
		function touchmoveFunc(e) {
			e.preventDefault();
			map.ondragstart = function() { return false; };
			if(zoom)
			{
				new_dist=(e.touches[0].x-e.touches[1].x) * (e.touches[0].x-e.touches[1].x) + (e.touches[0].y-e.touches[1].y) * (e.touches[0].y-e.touches[1].y);
				if(new_dist!=dist)
				{
					down=false;
					if(new_dist>dist)
					{
						alert(new_dist-dist);
					}
					else
					{
						alert(new_dist-dist);
					}
					map.style.transformOrigin=Math.abs((e.touches[0].x-e.touches[1].x)/2) + "px " + Math.abs((e.touches[0].y-e.touches[1].y)/2) + "px 0px";
					map.style.transform="scale("+tchscale+")";
					if(e.touches.length==1)
						down=true;
				}
				dist=new_dist;
			}
			if(down)
			{
				cursorPos=[
					e.changedTouches[0].clientX,
					e.changedTouches[0].clientY
				];
				styleLeft=elOffset[0] + cursorPos[0];
				styleTop=elOffset[1] + cursorPos[1];
				if(styleTop>0)
					styleTop=0;
				if(styleTop<-(map.clientHeight-document.documentElement.clientHeight))
					styleTop=-(map.clientHeight-document.documentElement.clientHeight);
				if(styleLeft>0)
					styleLeft=0;
				if(styleLeft<-(map.clientWidth-document.documentElement.clientWidth))
					styleLeft=-(map.clientWidth-document.documentElement.clientWidth);
				map.style.left =  styleLeft+ 'px';
				map.style.top = styleTop + 'px';
			}
		}
		var scale=1.0;
		function mousewheelFunc(e) {
			var delta = e.detail ? e.detail*(-1) : e.wheelDelta/120;
			if(delta>0 && scale<=1.9)
			{
				scale+=delta/100;
			}
			if(delta<0 && scale>1)
			{
				scale+=delta/100;
			}
			map.style.transformOrigin=(e.clientX-map.offsetLeft) + "px " + (e.clientY-map.offsetTop) + "px 0px";
			map.style.transform="scale("+scale+")";
			if(!map.style.left || map.style.left=="0px")
				left=0;
			else
			{
				left=(map.style.left).match(/\d/g);
				left = -parseInt(left.join(""));
			}
		}
		
	</script>
</body>
</html>